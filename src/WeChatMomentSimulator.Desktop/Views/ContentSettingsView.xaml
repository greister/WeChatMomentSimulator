<UserControl x:Class="WeChatMomentSimulator.Desktop.Views.ContentSettingsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:WeChatMomentSimulator.Desktop.Views"
             xmlns:viewModels="clr-namespace:WeChatMomentSimulator.Desktop.ViewModels"
             xmlns:converters="clr-namespace:WeChatMomentSimulator.Desktop.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="*" d:DesignWidth="380"
             d:DataContext="{d:DesignInstance Type=viewModels:MainViewModel}">
    
    <UserControl.Resources>
       
        <!-- 分组框样式 -->
        <Style x:Key="GroupBoxStyle" TargetType="GroupBox">
            <Setter Property="BorderBrush" Value="#DDDDDD"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="GroupBox">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <Border Grid.Row="0" Background="Transparent" Padding="5,0,5,0">
                                <TextBlock Text="{TemplateBinding Header}" FontWeight="Bold" Margin="5,0,5,0"/>
                            </Border>
                            <Border Grid.Row="1" 
                                    BorderBrush="{TemplateBinding BorderBrush}" 
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    Background="{TemplateBinding Background}"
                                    CornerRadius="4"
                                    Padding="{TemplateBinding Padding}">
                                <ContentPresenter/>
                            </Border>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- 按钮样式 -->
        <Style x:Key="FlatButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#FFFFFF"/>
            <Setter Property="BorderBrush" Value="#DDDDDD"/>
            <Setter Property="Padding" Value="12,5"/>
        </Style>
    </UserControl.Resources>
    <!-- 外层卡片式边框 -->
    <Border Style="{StaticResource CardPanelStyle}">
        <DockPanel>
    <Border Background="White" CornerRadius="6">
        <DockPanel Margin="10">
            <TextBlock DockPanel.Dock="Top" Text="内容设置" FontSize="16" FontWeight="Bold" Margin="0,0,0,10"/>
            
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel>
                    <!-- 内容类型选择 -->
                    <GroupBox Header="内容类型" Style="{StaticResource GroupBoxStyle}" Background="White">
                        <StackPanel Orientation="Horizontal" Margin="0,5">
                            <RadioButton Content="纯文本" GroupName="ContentType" 
                                        IsChecked="{Binding ContentType, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=TextOnly}" 
                                        Margin="0,0,15,0"/>
                            <RadioButton Content="图片" GroupName="ContentType" 
                                        IsChecked="{Binding ContentType, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Image}" 
                                        Margin="0,0,15,0"/>
                            <RadioButton Content="九宫格" GroupName="ContentType" 
                                        IsChecked="{Binding ContentType, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=MultiImage}" 
                                        Margin="0,0,15,0"/>
                            <RadioButton Content="链接" GroupName="ContentType" 
                                        IsChecked="{Binding ContentType, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Link}"/>
                        </StackPanel>
                    </GroupBox>
                    
                    <!-- 历史信息 -->
                    <GroupBox Header="历史信息" Style="{StaticResource GroupBoxStyle}" Background="White">
                        <StackPanel>
                            <ComboBox ItemsSource="{Binding HistoryContents}" 
                                     SelectedItem="{Binding SelectedHistoryContent}"
                                     DisplayMemberPath="Title"
                                     Margin="0,5"/>
                            <Button Content="应用所选历史" 
                                   HorizontalAlignment="Right" 
                                   Margin="0,5,0,0"
                                   Command="{Binding ApplyHistoryCommand}"
                                   Style="{StaticResource FlatButtonStyle}"/>
                        </StackPanel>
                    </GroupBox>
                    
                    <!-- 根据所选内容类型显示不同的设置面板 -->
                    <ContentControl>
                        <ContentControl.Style>
                            <Style TargetType="ContentControl">
                                <Style.Triggers>
                                    <!-- 纯文本模式 -->
                                    <DataTrigger Binding="{Binding ContentType}" Value="TextOnly">
                                        <Setter Property="Content">
                                            <Setter.Value>
                                                <GroupBox Header="文本内容" Style="{StaticResource GroupBoxStyle}" Background="White">
                                                    <TextBox Text="{Binding ContentText}" 
                                                            TextWrapping="Wrap" 
                                                            AcceptsReturn="True" 
                                                            Height="100" 
                                                            Margin="0,5"/>
                                                </GroupBox>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>
                                    <!-- 单图模式 -->
                                    <DataTrigger Binding="{Binding ContentType}" Value="Image">
                                        <Setter Property="Content">
                                            <Setter.Value>
                                                <StackPanel>
                                                    <GroupBox Header="文本内容" Style="{StaticResource GroupBoxStyle}" Background="White">
                                                        <TextBox Text="{Binding ContentText}" 
                                                                TextWrapping="Wrap" 
                                                                AcceptsReturn="True" 
                                                                Height="80" 
                                                                Margin="0,5"/>
                                                    </GroupBox>
                                                    <GroupBox Header="图片设置" Style="{StaticResource GroupBoxStyle}" Background="White">
                                                        <StackPanel>
                                                            <Button Content="选择图片..." 
                                                                   Style="{StaticResource FlatButtonStyle}" 
                                                                   Command="{Binding SelectImageCommand}"
                                                                   HorizontalAlignment="Left"
                                                                   Margin="0,5"/>
                                                            
                                                            <Border BorderBrush="#DDDDDD" 
                                                                    BorderThickness="1" 
                                                                    Height="120" 
                                                                    Margin="0,5">
                                                                <Image Source="{Binding CurrentImage}" 
                                                                       Stretch="Uniform"/>
                                                            </Border>
                                                        </StackPanel>
                                                    </GroupBox>
                                                </StackPanel>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>
                                    <!-- 九宫格模式 -->
                                    <DataTrigger Binding="{Binding ContentType}" Value="MultiImage">
                                        <Setter Property="Content">
                                            <Setter.Value>
                                                <StackPanel>
                                                    <GroupBox Header="文本内容" Style="{StaticResource GroupBoxStyle}" Background="White">
                                                        <TextBox Text="{Binding ContentText}" 
                                                                TextWrapping="Wrap" 
                                                                AcceptsReturn="True" 
                                                                Height="80" 
                                                                Margin="0,5"/>
                                                    </GroupBox>
                                                    <GroupBox Header="多图设置" Style="{StaticResource GroupBoxStyle}" Background="White">
                                                        <StackPanel>
                                                            <Button Content="选择多张图片..." 
                                                                   Style="{StaticResource FlatButtonStyle}" 
                                                                   Command="{Binding SelectMultipleImagesCommand}"
                                                                   HorizontalAlignment="Left"
                                                                   Margin="0,5"/>
                                                            
                                                            <TextBlock Text="{Binding SelectedImagesCount, StringFormat=已选择 {0} 张图片}" 
                                                                      Margin="0,5"/>
                                                            
                                                            <UniformGrid Columns="3" Rows="3" Margin="0,5">
                                                                <Border BorderBrush="#DDDDDD" BorderThickness="1" Margin="2">
                                                                    <Image Source="{Binding ImagePreview[0]}" Height="50" Stretch="UniformToFill"/>
                                                                </Border>
                                                                <Border BorderBrush="#DDDDDD" BorderThickness="1" Margin="2">
                                                                    <Image Source="{Binding ImagePreview[1]}" Height="50" Stretch="UniformToFill"/>
                                                                </Border>
                                                                <Border BorderBrush="#DDDDDD" BorderThickness="1" Margin="2">
                                                                    <Image Source="{Binding ImagePreview[2]}" Height="50" Stretch="UniformToFill"/>
                                                                </Border>
                                                                <Border BorderBrush="#DDDDDD" BorderThickness="1" Margin="2">
                                                                    <Image Source="{Binding ImagePreview[3]}" Height="50" Stretch="UniformToFill"/>
                                                                </Border>
                                                                <Border BorderBrush="#DDDDDD" BorderThickness="1" Margin="2">
                                                                    <Image Source="{Binding ImagePreview[4]}" Height="50" Stretch="UniformToFill"/>
                                                                </Border>
                                                                <Border BorderBrush="#DDDDDD" BorderThickness="1" Margin="2">
                                                                    <Image Source="{Binding ImagePreview[5]}" Height="50" Stretch="UniformToFill"/>
                                                                </Border>
                                                                <Border BorderBrush="#DDDDDD" BorderThickness="1" Margin="2">
                                                                    <Image Source="{Binding ImagePreview[6]}" Height="50" Stretch="UniformToFill"/>
                                                                </Border>
                                                                <Border BorderBrush="#DDDDDD" BorderThickness="1" Margin="2">
                                                                    <Image Source="{Binding ImagePreview[7]}" Height="50" Stretch="UniformToFill"/>
                                                                </Border>
                                                                <Border BorderBrush="#DDDDDD" BorderThickness="1" Margin="2">
                                                                    <Image Source="{Binding ImagePreview[8]}" Height="50" Stretch="UniformToFill"/>
                                                                </Border>
                                                            </UniformGrid>
                                                        </StackPanel>
                                                    </GroupBox>
                                                </StackPanel>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>
                                    <!-- 链接模式 -->
                                    <DataTrigger Binding="{Binding ContentType}" Value="Link">
                                        <Setter Property="Content">
                                            <Setter.Value>
                                                <StackPanel>
                                                    <GroupBox Header="文本内容" Style="{StaticResource GroupBoxStyle}" Background="White">
                                                        <TextBox Text="{Binding ContentText}" 
                                                                TextWrapping="Wrap" 
                                                                AcceptsReturn="True" 
                                                                Height="60" 
                                                                Margin="0,5"/>
                                                    </GroupBox>
                                                    <GroupBox Header="链接设置" Style="{StaticResource GroupBoxStyle}" Background="White">
                                                        <Grid>
                                                            <Grid.RowDefinitions>
                                                                <RowDefinition Height="Auto"/>
                                                                <RowDefinition Height="Auto"/>
                                                                <RowDefinition Height="Auto"/>
                                                            </Grid.RowDefinitions>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="Auto"/>
                                                                <ColumnDefinition Width="*"/>
                                                            </Grid.ColumnDefinitions>
                                                            
                                                            <TextBlock Grid.Row="0" Grid.Column="0" Text="链接地址:" VerticalAlignment="Center" Margin="0,5,10,5"/>
                                                            <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding LinkUrl}" Margin="0,5"/>
                                                            
                                                            <TextBlock Grid.Row="1" Grid.Column="0" Text="链接标题:" VerticalAlignment="Center" Margin="0,0,10,5"/>
                                                            <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding LinkTitle}" Margin="0,0,0,5"/>
                                                            
                                                            <TextBlock Grid.Row="2" Grid.Column="0" Text="链接图片:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                                                    <Button Grid.Row="2" Grid.Column="1" Content="选择图片..." Style="{StaticResource FlatButtonStyle}" Command="{Binding SelectLinkImageCommand}" HorizontalAlignment="Left"/>
                                                        </Grid>
                                                    </GroupBox>
                                                </StackPanel>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </ContentControl.Style>
                    </ContentControl>
                    
                    <!-- 地理位置设置 -->
                    <GroupBox Header="地理位置" Style="{StaticResource GroupBoxStyle}" Background="White">
                        <StackPanel>
                            <CheckBox Content="添加位置信息" IsChecked="{Binding AddLocation}" Margin="0,5"/>
                            <Grid IsEnabled="{Binding AddLocation}" Margin="0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox Grid.Column="0" Text="{Binding LocationText}" />
                                <Button Grid.Column="1" Content="..." Width="30" Margin="5,0,0,0" Command="{Binding SelectLocationCommand}"/>
                            </Grid>
                        </StackPanel>
                    </GroupBox>
                    
                    <!-- 互动设置 -->
                    <GroupBox Header="互动设置" Style="{StaticResource GroupBoxStyle}" Background="White">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <TextBlock Grid.Row="0" Grid.Column="0" Text="点赞数量:" VerticalAlignment="Center" Margin="0,5,10,5"/>
                            <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding LikeCount}" Width="60" HorizontalAlignment="Left" Margin="0,5"/>
                            
                            <TextBlock Grid.Row="1" Grid.Column="0" Text="回复数量:" VerticalAlignment="Center" Margin="0,0,10,5"/>
                            <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding CommentCount}" Width="60" HorizontalAlignment="Left"/>
                        </Grid>
                    </GroupBox>
                    
                    <!-- 回复设置 -->
                    <GroupBox Header="回复设置" Style="{StaticResource GroupBoxStyle}" Background="White">
                        <StackPanel>
                            <TextBlock Text="内容来源:" Margin="0,0,0,5"/>
                            <ComboBox ItemsSource="{Binding CommentSourceOptions}" 
                                     SelectedItem="{Binding SelectedCommentSource}" 
                                     Margin="0,0,0,10"/>
                                     
                            <Button Content="编辑回复内容..." 
                                   Command="{Binding EditCommentsCommand}" 
                                   HorizontalAlignment="Right"
                                   Style="{StaticResource FlatButtonStyle}"/>
                        </StackPanel>
                    </GroupBox>
                    
                    <!-- 操作按钮区 -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10,0,0">
                                <Button Content="保存模板" Style="{StaticResource FlatButtonStyle}" Margin="0,0,5,0" Command="{Binding SaveTemplateCommand}"/>
                                <Button Content="高级设置" Style="{StaticResource FlatButtonStyle}" Margin="5,0,0,0" Command="{Binding AdvancedSettingsCommand}"/>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </DockPanel>
    </Border>
            </DockPanel>
        </Border>
</UserControl>